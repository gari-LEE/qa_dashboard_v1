<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA í‰ê°€ ì´ë²¤íŠ¸ ëŒ€ì‹œë³´ë“œ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --background-color: #f5f7fa;
            --card-bg-color: #ffffff;
            --text-color: #333;
            --light-text-color: #7f8c8d;
            --border-color: #e0e7ff;
            --team1-bg: #e0f2fe;
            --team1-color: #0284c7;
            --team2-bg: #fce7f3;
            --team2-color: #be185d;
            --gold-color: #ffd43b;
            --danger-color: #e74c3c;
            --success-color: #2ecc71;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .ai-button {
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .ai-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: var(--card-bg-color);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: 700;
        }

        .tab:hover:not(.active) {
            background: #f0f4ff;
            transform: translateY(-2px);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--card-bg-color);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-header h3, .top-scorers-section .card-header h4 {
            color: var(--secondary-color);
            font-size: 18px;
            font-weight: 700;
            margin: 0;
        }

        .toggle-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }
        
        .toggle-btn svg {
            transition: transform 0.3s ease;
            stroke: var(--light-text-color);
        }
        
        .toggle-btn:hover {
            background-color: #f0f0f0;
        }

        .toggle-btn.collapsed svg {
            transform: rotate(-180deg);
        }
        
        .card-content.hidden {
            display: none;
        }
        
        .sortable-ghost {
            opacity: 0.4;
            background: var(--border-color);
        }
        
        /* Styles for Standard Quarterly View */
        .metric { font-size: 36px; font-weight: bold; color: var(--primary-color); margin-bottom: 5px; }
        .metric-label { color: var(--light-text-color); font-size: 14px; }
        .list-item { padding: 10px 15px; background: #f8f9fa; margin-bottom: 8px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; font-weight: 500; }
        .list-item:last-child { margin-bottom: 0; }
        .team-badge { padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 500; }
        .team-badge.team1 { background: var(--team1-bg); color: var(--team1-color); }
        .team-badge.team2 { background: var(--team2-bg); color: var(--team2-color); }
        .score-badge { background: #f1f3f5; color: #495057; padding: 4px 10px; border-radius: 6px; font-weight: 600; }
        .perfect-score { background: #fff9db; border: 1px solid var(--gold-color); color: #5c4e00; padding: 10px 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; font-weight: 500; }
        .top-scorers-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .top-scorers-section { background: var(--card-bg-color); padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .score-distribution { display: flex; flex-direction: column; gap: 10px; }
        .score-bar { display: flex; align-items: center; gap: 10px; }
        .score-label { width: 80px; font-size: 14px; color: #666; flex-shrink: 0; }
        .bar-container { flex: 1; height: 30px; background: #f0f0f0; border-radius: 15px; overflow: hidden; position: relative; }
        .bar-fill { height: 100%; background: linear-gradient(90deg, #3498db, #2ecc71); border-radius: 15px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px; color: white; font-weight: 500; font-size: 14px; transition: width 0.5s ease-in-out; }

        /* Styles for Analysis View */
        .analysis-card { padding: 20px; }
        .analysis-card h4 { font-size: 16px; margin-bottom: 15px; color: var(--secondary-color); }
        .problem-highlight {
            background-color: #fff9f2;
            border: 1px solid #f39c12;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .problem-highlight .workload {
            font-size: 15px;
            font-weight: 500;
            color: #d35400;
            text-align: center;
        }
        .problem-highlight .workload strong { font-size: 24px; }
        .problem-highlight .workload-detail {
            font-size: 13px;
            text-align: center;
            color: var(--light-text-color);
            margin-top: 5px;
        }
        .comparison-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .comparison-table th, .comparison-table td { border: 1px solid #e9ecef; padding: 12px; text-align: center; font-size: 14px; }
        .comparison-table th { background-color: #f8f9fa; }
        .comparison-table td:first-child { text-align: left; font-weight: 500; }
        .comparison-table .highlight-bad { color: var(--danger-color); font-weight: 700; }
        .comparison-table .highlight-good { color: var(--success-color); font-weight: 700; }

        .recommendation {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8faff;
            border-left: 4px solid var(--primary-color);
            border-radius: 4px;
        }
        .recommendation h4 { font-size: 16px; margin-bottom: 10px; }
        .recommendation p { font-size: 14px; line-height: 1.7; }
        .recommendation strong { color: var(--primary-color); }
        .recommendation .budget-info {
            margin-top: 10px;
            padding: 10px;
            background-color: #e9f5ff;
            border-radius: 6px;
            font-weight: 500;
        }
        .insight {
            margin-top: 15px;
            padding: 12px;
            background-color: #fdf9e7;
            border-left: 4px solid var(--gold-color);
            border-radius: 4px;
            font-size: 14px;
            line-height: 1.6;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .modal-header h2 {
            font-size: 22px;
            color: var(--secondary-color);
        }
        .modal-close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--light-text-color);
        }
        .modal-body {
            line-height: 1.8;
        }
        .modal-body h3 {
            font-size: 18px;
            color: var(--primary-color);
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .modal-body ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        .modal-body li {
            margin-bottom: 8px;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>QA í‰ê°€ ì´ë²¤íŠ¸ ëŒ€ì‹œë³´ë“œ</h1>
                <p>ìƒë‹´í’ˆì§ˆ í–¥ìƒì„ ìœ„í•œ ìš°ìˆ˜ì½œ ì´ë²¤íŠ¸ í˜„í™©</p>
            </div>
            <button class="ai-button" id="ai-analysis-btn">âœ¨ AIë¡œ ì „ì²´ ë°ì´í„° ë¶„ì„í•˜ê¸°</button>
        </div>

        <div class="tabs" id="tabs">
            <div class="tab" id="tab-overall" onclick="showOverall()">ì „ì²´</div>
            <div class="tab" onclick="showQuarter('24ë…„ 1ë¶„ê¸°')">24ë…„ 1ë¶„ê¸°</div>
            <div class="tab" onclick="showQuarter('24ë…„ 2ë¶„ê¸°')">24ë…„ 2ë¶„ê¸°</div>
            <div class="tab" onclick="showQuarter('24ë…„ 3ë¶„ê¸°')">24ë…„ 3ë¶„ê¸°</div>
            <div class="tab" onclick="showQuarter('24ë…„ 4ë¶„ê¸°')">24ë…„ 4ë¶„ê¸°</div>
            <div class="tab" onclick="showQuarter('25ë…„ 1ë¶„ê¸°')">25ë…„ 1ë¶„ê¸°</div>
            <div class="tab" onclick="showQuarter('25ë…„ 2ë¶„ê¸°')">25ë…„ 2ë¶„ê¸°</div>
        </div>

        <div id="quarterContent"></div>

        <div class="card" style="margin-top: 30px;">
             <div class="card-header">
                 <h3>ë¶„ê¸°ë³„ í‰ê·  ì ìˆ˜ ì¶”ì´</h3>
                 <button class="toggle-btn" aria-label="ì°¨íŠ¸ ë³´ê¸°/ìˆ¨ê¸°ê¸°">
                     <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>
                 </button>
             </div>
             <div class="card-content">
                 <div class="chart-container" style="height: 300px;">
                     <canvas id="trendChart"></canvas>
                 </div>
             </div>
        </div>
    </div>
    
    <!-- AI Analysis Modal -->
    <div class="modal-overlay" id="ai-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âœ¨ AI ë°ì´í„° ë¶„ì„ ë¦¬í¬íŠ¸</h2>
                <button class="modal-close-btn" id="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body" id="ai-modal-body">
                <!-- AI response will be injected here -->
            </div>
        </div>
    </div>


    <script>
        const data = {"quarters": {"24ë…„ 1ë¶„ê¸°": {"team_avg": {"1íŒ€": 72.5, "2íŒ€": 73.5}, "perfect_scorers": [{"name": "ê¹€í˜„ì •", "team": "2íŒ€"}], "top_non_perfect": [{"name": "ê¹€ë‚˜ì„±", "team": "1íŒ€", "score": 95}, {"name": "ê¹€ì„ ì˜¥", "team": "1íŒ€", "score": 95}, {"name": "ìµœí˜œë ¹", "team": "1íŒ€", "score": 95}, {"name": "ê¹€ì§€í˜•", "team": "1íŒ€", "score": 95}, {"name": "ê¹€ê²½í¬", "team": "1íŒ€", "score": 90}, {"name": "ì–‘ìˆ˜ì§„", "team": "2íŒ€", "score": 90}, {"name": "ê°€ì˜ë¯¸", "team": "2íŒ€", "score": 85}, {"name": "ê¹€ì¸ê²½", "team": "1íŒ€", "score": 85}, {"name": "ì •ë¯¸í˜„", "team": "2íŒ€", "score": 85}, {"name": "ê³ ì§„ê²½", "team": "2íŒ€", "score": 85}, {"name": "ì´ì€ì›", "team": "1íŒ€", "score": 80}, {"name": "ì´ì¢…ì€", "team": "2íŒ€", "score": 80}, {"name": "ì´ë¯¸ë¼", "team": "2íŒ€", "score": 75}, {"name": "ë°•ë™ì—°", "team": "2íŒ€", "score": 75}, {"name": "ê³½ì§€ì€", "team": "2íŒ€", "score": 75}], "top3": [{"name": "ê¹€í˜„ì •", "team": "2íŒ€", "score": 100}, {"name": "ìµœí˜œë ¹", "team": "1íŒ€", "score": 95}, {"name": "ê¹€ì„ ì˜¥", "team": "1íŒ€", "score": 95}], "score_distribution": {"90-100ì ": 7, "80-89ì ": 6, "70-79ì ": 7, "60-69ì ": 4, "60ì  ë¯¸ë§Œ": 4}, "total_count": 28, "average_score": 72.7}, "24ë…„ 2ë¶„ê¸°": {"team_avg": {"1íŒ€": 81.4, "2íŒ€": 75.7}, "perfect_scorers": [{"name": "ì •ë¯¸í˜„", "team": "2íŒ€"}, {"name": "ê³ ì§„ê²½", "team": "1íŒ€"}, {"name": "ê¹€í˜„ì •", "team": "2íŒ€"}], "top_non_perfect": [{"name": "ê¹€ì„ ì˜¥", "team": "1íŒ€", "score": 95}, {"name": "ê³µì§„ìˆ™", "team": "1íŒ€", "score": 95}, {"name": "ì´í˜¸ì§„", "team": "1íŒ€", "score": 90}, {"name": "ê¹€ë‚˜ì„±", "team": "1íŒ€", "score": 90}, {"name": "ë°•ì—°í™”", "team": "1íŒ€", "score": 90}, {"name": "ì´ë¯¸ë¼", "team": "2íŒ€", "score": 85}, {"name": "ë°•ë¯¸ì—°", "team": "2íŒ€", "score": 85}, {"name": "ê¹€í˜„ìš°", "team": "1íŒ€", "score": 85}, {"name": "ì´ì¢…ì€", "team": "2íŒ€", "score": 85}, {"name": "ì–‘ìˆ˜ì§„", "team": "2íŒ€", "score": 80}, {"name": "ìµœí˜œë ¹", "team": "2íŒ€", "score": 80}, {"name": "ì´ì€ì›", "team": "2íŒ€", "score": 80}, {"name": "ê¹€ì§€í˜•", "team": "1íŒ€", "score": 80}, {"name": "ê¹€ê²½í¬", "team": "1íŒ€", "score": 80}, {"name": "ê¹€ìˆ˜ê²½", "team": "1íŒ€", "score": 75}, {"name": "ì„œì§€ê²½", "team": "1íŒ€", "score": 75}], "top3": [{"name": "ì •ë¯¸í˜„", "team": "2íŒ€", "score": 100}, {"name": "ê³ ì§„ê²½", "team": "1íŒ€", "score": 100}, {"name": "ê¹€í˜„ì •", "team": "2íŒ€", "score": 100}], "score_distribution": {"90-100ì ": 8, "80-89ì ": 9, "70-79ì ": 4, "60-69ì ": 4, "60ì  ë¯¸ë§Œ": 3}, "total_count": 28, "average_score": 78.2}, "24ë…„ 3ë¶„ê¸°": {"team_avg": {"1íŒ€": 72.8, "2íŒ€": 73.4}, "perfect_scorers": [{"name": "ê¹€í˜„ì •", "team": "2íŒ€"}], "top_non_perfect": [{"name": "ê¶Œë¯¸ë‚˜", "team": "2íŒ€", "score": 95}, {"name": "ë°•ì˜ê²½", "team": "2íŒ€", "score": 95}, {"name": "ê¹€ì§€í˜•", "team": "1íŒ€", "score": 90}, {"name": "ì •ë¯¸í˜„", "team": "2íŒ€", "score": 90}, {"name": "ì´í˜¸ì§„", "team": "1íŒ€", "score": 90}, {"name": "ê³µì§„ìˆ™", "team": "1íŒ€", "score": 90}, {"name": "ì–‘ìˆ˜ì§„", "team": "2íŒ€", "score": 85}, {"name": "ê³ ì§„ê²½", "team": "1íŒ€", "score": 85}, {"name": "ê¹€ì¸ê²½", "team": "1íŒ€", "score": 80}, {"name": "ì´ì¢…ì€", "team": "2íŒ€", "score": 80}, {"name": "ë°•ë¯¸ì—°", "team": "2íŒ€", "score": 80}, {"name": "ê¹€ë‚˜ì„±", "team": "1íŒ€", "score": 75}, {"name": "ì„œì§€ê²½", "team": "1íŒ€", "score": 75}, {"name": "ì •í˜¸ì„­", "team": "1íŒ€", "score": 75}, {"name": "ì´ë¯¸ë¼", "team": "2íŒ€", "score": 75}], "top3": [{"name": "ê¹€í˜„ì •", "team": "2íŒ€", "score": 100}, {"name": "ë°•ì˜ê²½", "team": "2íŒ€", "score": 95}, {"name": "ê¶Œë¯¸ë‚˜", "team": "2íŒ€", "score": 95}], "score_distribution": {"90-100ì ": 7, "80-89ì ": 5, "70-79ì ": 7, "60-69ì ": 7, "60ì  ë¯¸ë§Œ": 5}, "total_count": 31, "average_score": 72.8}, "24ë…„ 4ë¶„ê¸°": {"team_avg": {"1íŒ€": 75.0, "2íŒ€": 74.9}, "perfect_scorers": [{"name": "ë°©ì§€ì˜", "team": "1íŒ€"}, {"name": "ì´ì¢…ì€", "team": "2íŒ€"}, {"name": "ì •ë¯¸í˜„", "team": "2íŒ€"}], "top_non_perfect": [{"name": "ê¹€í˜„ì •", "team": "2íŒ€", "score": 95}, {"name": "ê¹€í˜„ìš°", "team": "1íŒ€", "score": 90}, {"name": "ê¹€ì§€í˜•", "team": "1íŒ€", "score": 90}, {"name": "ê³µì§„ìˆ™", "team": "1íŒ€", "score": 90}, {"name": "ìµœí˜œë ¹", "team": "2íŒ€", "score": 90}, {"name": "ìµœì€ë¯¸", "team": "2íŒ€", "score": 85}, {"name": "ê°€ì˜ë¯¸", "team": "2íŒ€", "score": 85}, {"name": "ë°•ì˜ê²½", "team": "2íŒ€", "score": 85}, {"name": "ê¹€ì„ ì˜¥", "team": "1íŒ€", "score": 85}, {"name": "ê¶Œë¯¸ë‚˜", "team": "2íŒ€", "score": 85}, {"name": "ê¹€ë‚˜ì„±", "team": "1íŒ€", "score": 85}, {"name": "ê¹€ê²½í¬", "team": "1íŒ€", "score": 80}, {"name": "ê¹€ì¸ê²½", "team": "1íŒ€", "score": 80}, {"name": "ë°•ë¯¸ì—°", "team": "2íŒ€", "score": 75}, {"name": "ê³ ì§„ê²½", "team": "1íŒ€", "score": 75}, {"name": "ì •í˜¸ì„­", "team": "1íŒ€", "score": 75}, {"name": "ë°•ì—°í™”", "team": "1íŒ€", "score": 75}], "top3": [{"name": "ë°©ì§€ì˜", "team": "1íŒ€", "score": 100}, {"name": "ì´ì¢…ì€", "team": "2íŒ€", "score": 100}, {"name": "ì •ë¯¸í˜„", "team": "2íŒ€", "score": 100}], "score_distribution": {"90-100ì ": 8, "80-89ì ": 8, "70-79ì ": 5, "60-69ì ": 5, "60ì  ë¯¸ë§Œ": 5}, "total_count": 31, "average_score": 74.7}, "25ë…„ 1ë¶„ê¸°": {"team_avg": {"1íŒ€": 80.8, "2íŒ€": 72.7}, "perfect_scorers": [{"name": "ë°©ì§€ì˜", "team": "1íŒ€"}, {"name": "ê³µì§„ìˆ™", "team": "1íŒ€"}], "top_non_perfect": [{"name": "ê³ ì§„ê²½", "team": "1íŒ€", "score": 95}, {"name": "ì •í˜¸ì„­", "team": "1íŒ€", "score": 95}, {"name": "ê¹€ì¸ê²½", "team": "1íŒ€", "score": 95}, {"name": "ê°€ì˜ë¯¸", "team": "2íŒ€", "score": 95}, {"name": "ì •ë¯¸í˜„", "team": "2íŒ€", "score": 95}, {"name": "ìœ ì§€ìˆ˜", "team": "2íŒ€", "score": 90}, {"name": "ê¹€ë‚˜ì„±", "team": "1íŒ€", "score": 90}, {"name": "ìœ¤ì •ìš´", "team": "1íŒ€", "score": 90}, {"name": "ì´ì¢…ì€", "team": "2íŒ€", "score": 90}, {"name": "ì´ì€ì›", "team": "2íŒ€", "score": 85}, {"name": "ê¹€ì„ ì˜¥", "team": "1íŒ€", "score": 85}, {"name": "ì •í˜„ì£¼", "team": "2íŒ€", "score": 85}, {"name": "ê¹€í˜„ì •", "team": "2íŒ€", "score": 80}, {"name": "ê¹€ê²½í¬", "team": "1íŒ€", "score": 80}, {"name": "ê¹€ì§€í˜•", "team": "1íŒ€", "score": 75}, {"name": "ìµœì€ë¯¸", "team": "2íŒ€", "score": 75}, {"name": "ê¶Œë¯¸ë‚˜", "team": "2íŒ€", "score": 75}, {"name": "ê¹€ë¯¸ì •", "team": "2íŒ€", "score": 75}], "top3": [{"name": "ë°©ì§€ì˜", "team": "1íŒ€", "score": 100}, {"name": "ê³µì§„ìˆ™", "team": "1íŒ€", "score": 100}, {"name": "ì •í˜¸ì„­", "team": "1íŒ€", "score": 95}], "score_distribution": {"90-100ì ": 11, "80-89ì ": 5, "70-79ì ": 6, "60-69ì ": 8, "60ì  ë¯¸ë§Œ": 4}, "total_count": 34, "average_score": 76.6}, "25ë…„ 2ë¶„ê¸°": {"team_avg": {"1íŒ€": 78.1, "2íŒ€": 76.9}, "perfect_scorers": [{"name": "ì •ë¯¸í˜„", "team": "2íŒ€"}], "top_non_perfect": [{"name": "ìœ¤ì •ìš´", "team": "1íŒ€", "score": 95}, {"name": "ê¹€ì§€í˜•", "team": "1íŒ€", "score": 95}, {"name": "ìœ ì§€ìˆ˜", "team": "2íŒ€", "score": 95}, {"name": "ì´ë¯¸ë¼", "team": "2íŒ€", "score": 95}, {"name": "ê°€ì˜ë¯¸", "team": "2íŒ€", "score": 90}, {"name": "ê¹€í˜„ì •", "team": "2íŒ€", "score": 90}, {"name": "ì´ì€ì›", "team": "2íŒ€", "score": 90}, {"name": "ê¶Œë¯¸ë‚˜", "team": "2íŒ€", "score": 90}, {"name": "ë°•ì—°í™”", "team": "1íŒ€", "score": 85}, {"name": "ë°•ë™ì—°", "team": "2íŒ€", "score": 85}, {"name": "ê¹€í˜„ìš°", "team": "1íŒ€", "score": 85}, {"name": "ê³ ì§„ê²½", "team": "1íŒ€", "score": 80}, {"name": "ì–‘ì„ í¬", "team": "2íŒ€", "score": 75}, {"name": "ì •í˜¸ì„­", "team": "1íŒ€", "score": 75}, {"name": "ê¹€ì„œì¸", "team": "1íŒ€", "score": 75}, {"name": "ê¹€ê²½í¬", "team": "1íŒ€", "score": 75}, {"name": "ìœ ê°€ì€", "team": "2íŒ€", "score": 75}, {"name": "ê¹€ì¸ê²½", "team": "1íŒ€", "score": 75}, {"name": "ê³µì§„ìˆ™", "team": "1íŒ€", "score": 75}, {"name": "ìµœí˜œë ¹", "team": "2íŒ€", "score": 75}, {"name": "ê¹€ì„ ì˜¥", "team": "1íŒ€", "score": 75}], "top3": [{"name": "ì •ë¯¸í˜„", "team": "2íŒ€", "score": 100}, {"name": "ìœ¤ì •ìš´", "team": "1íŒ€", "score": 95}, {"name": "ê¹€ì§€í˜•", "team": "1íŒ€", "score": 95}], "score_distribution": {"90-100ì ": 9, "80-89ì ": 4, "70-79ì ": 15, "60-69ì ": 3, "60ì  ë¯¸ë§Œ": 2}, "total_count": 33, "average_score": 77.2}}, "timeline": [{"quarter": "24ë…„ 1ë¶„ê¸°", "average": 72.7, "team1_avg": 72.5, "team2_avg": 73.5}, {"quarter": "24ë…„ 2ë¶„ê¸°", "average": 78.2, "team1_avg": 81.4, "team2_avg": 75.7}, {"quarter": "24ë…„ 3ë¶„ê¸°", "average": 72.8, "team1_avg": 72.8, "team2_avg": 73.4}, {"quarter": "24ë…„ 4ë¶„ê¸°", "average": 74.7, "team1_avg": 75.0, "team2_avg": 74.9}, {"quarter": "25ë…„ 1ë¶„ê¸°", "average": 76.6, "team1_avg": 80.8, "team2_avg": 72.7}, {"quarter": "25ë…„ 2ë¶„ê¸°", "average": 77.2, "team1_avg": 78.1, "team2_avg": 76.9}], "generated_at": "2025-07-22 08:32:59"};
        let trendChart = null;

        const cardToggleIcon = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>`;

        function setActiveTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId)?.classList.add('active');
        }

        function getMedian(numbers) {
            if (numbers.length === 0) return 0;
            const sorted = [...numbers].sort((a, b) => a - b);
            const middleIndex = Math.floor(sorted.length / 2);
            if (sorted.length % 2 === 0) {
                return Math.round((sorted[middleIndex - 1] + sorted[middleIndex]) / 2);
            } else {
                return sorted[middleIndex];
            }
        }

        function showOverall() {
            setActiveTab('tab-overall');
            const content = document.getElementById('quarterContent');
            
            const historicalCounts = { 100: [], 95: [], 90: [] };
            let awardsByQuarter = {};
            let awardsBreakdownByQuarter = {};

            for (const quarterKey in data.quarters) {
                const qData = data.quarters[quarterKey];
                const topCount = qData.perfect_scorers.length;
                const excellentCount = qData.top_non_perfect.filter(s => s.score === 95).length;
                const encouragementCount = qData.top_non_perfect.filter(s => s.score === 90).length;

                historicalCounts[100].push(topCount);
                historicalCounts[95].push(excellentCount);
                historicalCounts[90].push(encouragementCount);

                awardsByQuarter[quarterKey] = topCount + excellentCount + encouragementCount;
                awardsBreakdownByQuarter[quarterKey] = {
                    top: topCount,
                    excellent: excellentCount,
                    encouragement: encouragementCount
                };
            }

            const minAwards = Math.min(...Object.values(awardsByQuarter));
            const maxAwards = Math.max(...Object.values(awardsByQuarter));
            
            const minQuarters = Object.keys(awardsByQuarter).filter(key => awardsByQuarter[key] === minAwards);
            const maxQuarters = Object.keys(awardsByQuarter).filter(key => awardsByQuarter[key] === maxAwards);

            const maxQuartersString = maxQuarters.map(q => {
                const breakdown = awardsBreakdownByQuarter[q];
                return `${q} (100ì  ${breakdown.top}ëª…, 95ì  ${breakdown.excellent}ëª…, 90ì  ${breakdown.encouragement}ëª…)`;
            }).join(', ');

            const minQuartersString = minQuarters.map(q => {
                const breakdown = awardsBreakdownByQuarter[q];
                return `${q} (100ì  ${breakdown.top}ëª…, 95ì  ${breakdown.excellent}ëª…, 90ì  ${breakdown.encouragement}ëª…)`;
            }).join(', ');

            const medianScores = {
                100: getMedian(historicalCounts[100]) || 1,
                95: getMedian(historicalCounts[95]) || 2,
                90: getMedian(historicalCounts[90]) || 3
            };
            
            const { 100: X, 95: Y, 90: Z } = medianScores;
            const unrewardedHighAchievers = (X > 1 ? X - 1 : 0) + (Y > 1 ? Y - 1 : 0) + (Z > 3 ? Z - 3 : 0);

            const newBudget1st = X * 50000;
            const newBudget2nd = Y * 30000;
            const newBudget3rd = Z * 10000;
            const totalNewBudget = newBudget1st + newBudget2nd + newBudget3rd;

            const summaryHtml = `
                <div class="insight" style="margin-top: 25px; border-left-color: var(--secondary-color);">
                    <h5 style="margin-bottom: 15px; font-size: 15px; color: var(--secondary-color); padding-bottom: 5px; border-bottom: 1px solid #eee;">ë¶„ê¸°ë³„ ê³ ë“ì ì í˜„í™© ìš”ì•½ (24ë…„ 1ë¶„ê¸° ~ 25ë…„ 2ë¶„ê¸°)</h5>
                    <p style="font-size: 14px; margin-bottom: 5px; line-height: 1.6;"><strong>ğŸ… ê³ ë“ì ì ìµœë‹¤ ë¶„ê¸° (${maxAwards}ëª…):</strong> ${maxQuartersString}</p>
                    <p style="font-size: 14px; margin-bottom: 15px; line-height: 1.6;"><strong>ğŸ“‰ ê³ ë“ì ì ìµœì†Œ ë¶„ê¸° (${minAwards}ëª…):</strong> ${minQuartersString}</p>
                </div>
            `;

            content.innerHTML = `
                <div class="dashboard">
                     <div class="card analysis-card">
                         <h4>ğŸ“… ê³¼ê±° ë°ì´í„° ê¸°ë°˜ 25ë…„ 3ë¶„ê¸° ìˆ˜ìƒ ì¸ì› ì˜ˆì¸¡</h4>
                         <table class="comparison-table">
                             <thead><tr><th>ì ìˆ˜</th><th>ê³¼ê±° ë¶„ê¸°ë³„ ë°œìƒ (ìµœì†Œ-ìµœëŒ€)</th><th>25ë…„ 3ë¶„ê¸° ì˜ˆìƒ ì¸ì› (ì¤‘ê°„ê°’)</th></tr></thead>
                             <tbody>
                                 <tr><td>100ì  (ìµœìš°ìˆ˜)</td><td>${Math.min(...historicalCounts[100])}-${Math.max(...historicalCounts[100])}ëª…</td><td class="highlight-bad">${X}ëª…</td></tr>
                                 <tr><td>95ì  (ìš°ìˆ˜)</td><td>${Math.min(...historicalCounts[95])}-${Math.max(...historicalCounts[95])}ëª…</td><td class="highlight-bad">${Y}ëª…</td></tr>
                                 <tr><td>90ì  (ì¥ë ¤)</td><td>${Math.min(...historicalCounts[90])}-${Math.max(...historicalCounts[90])}ëª…</td><td class="highlight-bad">${Z}ëª…</td></tr>
                             </tbody>
                         </table>
                         <p class="insight">ê³¼ê±° ë°ì´í„°ë¥¼ ë³¼ ë•Œ, ì´ë²ˆ ë¶„ê¸°ì—ë„ <strong>ìƒìœ„ê¶Œ ë™ì ìê°€ ë‹¤ìˆ˜ ë°œìƒí•  í™•ë¥ ì´ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤.</strong></p>
                     </div>
                    <div class="card analysis-card">
                        <h4>ğŸ¯ í˜„í–‰ ê³„íšì˜ í•œê³„ì : ê³µì •ì„± ë° ë™ê¸°ë¶€ì—¬ ì €í•˜</h4>
                        <div class="problem-highlight">
                            <p class="workload">ìš°ìˆ˜ ì„±ê³¼ì <strong>${unrewardedHighAchievers}</strong>ëª…, ë³´ìƒ ì œì™¸ ì˜ˆìƒ</p>
                            <p class="workload-detail">ì˜ˆì¸¡ì— ë”°ë¥´ë©´, í˜„í–‰ ê³„íš ìœ ì§€ ì‹œ ìµœê³ ì ì„ ë°›ê³ ë„ ìˆ˜ìƒí•˜ì§€ ëª»í•˜ëŠ” ì¸ì›ì´ ë°œìƒí•©ë‹ˆë‹¤. ì´ëŠ” 'ìš´'ìœ¼ë¡œ ìˆ˜ìƒìê°€ ê²°ì •ëœë‹¤ëŠ” ì¸ì‹ì„ ì£¼ì–´ ì„±ê³¼ì— ëŒ€í•œ ì‹ ë¢°ë„ë¥¼ ë–¨ì–´ëœ¨ë¦¬ê³ , ë‹¤ë¥¸ ìš°ìˆ˜ ì§ì›ë“¤ì˜ ì‚¬ê¸°ë¥¼ ì €í•˜ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        </div>
                        ${summaryHtml}
                    </div>
                </div>
                <div class="card analysis-card" style="margin-top: 20px;">
                    <h4>ğŸ’¡ ì˜ê²¬
                    <div class="recommendation">
                        <h4>"ë™ì ìì˜ ê²½ìš° ê³µë™ ìˆ˜ìƒìœ¼ë¡œ ìš´ì˜í•˜ëŠ” ë°©ì•ˆì„ ê²€í† í•´ë³´ì‹œëŠ” ê²ƒì€ ì–´ë–¨ì§€ ì œì•ˆë“œë¦½ë‹ˆë‹¤."</h4>
                        <p>
                            ë™ì¼í•œ ì„±ê³¼ë¥¼ ë‚¸ ì§ì›ë“¤ì„ ëª¨ë‘ ì¸ì •í•˜ëŠ” 'ê³µë™ ìˆ˜ìƒ' ë°©ì‹ìœ¼ë¡œ ì „í™˜ ì‹œ, ìµœìƒìœ„ê¶Œ ì§ì› ëª¨ë‘ì—ê²Œ <strong>ê³µì •í•œ ë³´ìƒ</strong>ì„ ì œê³µí•˜ì—¬ íŒ€ ì „ì²´ì˜ <strong>ì‚¬ê¸° ì§„ì‘</strong>ì— ê¸°ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                        <div class="budget-info">
                            <strong>ì˜ˆìƒ ìˆ˜ìƒ ì¸ì›(${X+Y+Z}ëª…) ì „ì› ì‹œìƒ ì‹œ í•„ìš” ì˜ˆì‚°: ${totalNewBudget.toLocaleString()}ì›</strong><br>
                            (ê¸°ì¡´ 110,000ì› ëŒ€ë¹„ ${(totalNewBudget - 110000).toLocaleString()}ì› ì¦ì•¡ í•„ìš”)
                        </div>
                    </div>
                </div>
            `;
            new Sortable(document.querySelector('#quarterContent .dashboard'), { animation: 150, ghostClass: 'sortable-ghost' });
        }

        function showQuarter(quarterKey) {
            setActiveTab(`tab-${quarterKey.replace(' ', '-')}`);
            const quarterData = data.quarters[quarterKey];
            const content = document.getElementById('quarterContent');

            const perfectScorersHtml = quarterData.perfect_scorers.length > 0 ? quarterData.perfect_scorers.map(s => `<div class="perfect-score"><span>${s.name}</span><div style="display: flex; gap: 10px; align-items: center;"><span class="score-badge">100ì </span><span class="team-badge ${s.team === '1íŒ€' ? 'team1' : 'team2'}">${s.team}</span></div></div>`).join('') : '';
            
            const scorers95 = quarterData.top_non_perfect.filter(s => s.score === 95);
            const scorers95Html = scorers95.length > 0 ? scorers95.map((s) => `<div class="list-item"><span>${s.name}</span><div style="display: flex; gap: 10px; align-items: center;"><span class="score-badge">${s.score}ì </span><span class="team-badge ${s.team === '1íŒ€' ? 'team1' : 'team2'}">${s.team}</span></div></div>`).join('') : '';

            const scorers90 = quarterData.top_non_perfect.filter(s => s.score === 90);
            const scorers90Html = scorers90.length > 0 ? scorers90.map((s) => `<div class="list-item"><span>${s.name}</span><div style="display: flex; gap: 10px; align-items: center;"><span class="score-badge">${s.score}ì </span><span class="team-badge ${s.team === '1íŒ€' ? 'team1' : 'team2'}">${s.team}</span></div></div>`).join('') : '';

            const top3Html = quarterData.top3.map((s, i) => `<div class="list-item"><span>${i + 1}ìœ„. ${s.name}</span><div style="display: flex; gap: 10px; align-items: center;"><span class="score-badge">${s.score}ì </span><span class="team-badge ${s.team === '1íŒ€' ? 'team1' : 'team2'}">${s.team}</span></div></div>`).join('');
            
            const scoreDistHtml = Object.entries(quarterData.score_distribution).map(([range, count]) => {
                const percentage = quarterData.total_count > 0 ? (count / quarterData.total_count * 100).toFixed(1) : 0;
                return `<div class="score-bar">
                            <span class="score-label">${range}</span>
                            <div class="bar-container">
                                <div class="bar-fill" style="width: ${percentage}%">${count}ëª…</div>
                            </div>
                        </div>`;
            }).join('');

            content.innerHTML = `
                <div class="top-scorers-grid">
                    ${perfectScorersHtml ? `<div class="top-scorers-section"><div class="card-header"><h4>ğŸ† 100ì  ë‹¬ì„±ì (${quarterData.perfect_scorers.length}ëª…)</h4><button class="toggle-btn" aria-label="ì¹´ë“œ ë³´ê¸°/ìˆ¨ê¸°ê¸°">${cardToggleIcon}</button></div><div class="card-content">${perfectScorersHtml}</div></div>` : ''}
                    ${scorers95Html ? `<div class="top-scorers-section"><div class="card-header"><h4>ğŸ¥ˆ 95ì  ë“ì ì (${scorers95.length}ëª…)</h4><button class="toggle-btn" aria-label="ì¹´ë“œ ë³´ê¸°/ìˆ¨ê¸°ê¸°">${cardToggleIcon}</button></div><div class="card-content">${scorers95Html}</div></div>` : ''}
                    ${scorers90Html ? `<div class="top-scorers-section"><div class="card-header"><h4>ğŸ¥‰ 90ì  ë“ì ì (${scorers90.length}ëª…)</h4><button class="toggle-btn" aria-label="ì¹´ë“œ ë³´ê¸°/ìˆ¨ê¸°ê¸°">${cardToggleIcon}</button></div><div class="card-content">${scorers90Html}</div></div>` : ''}
                </div>
                <div class="dashboard">
                    <div class="card"><div class="card-header"><h3>ì „ì²´ í‰ê·  ì ìˆ˜</h3><button class="toggle-btn" aria-label="ì¹´ë“œ ë³´ê¸°/ìˆ¨ê¸°ê¸°">${cardToggleIcon}</button></div><div class="card-content"><div class="metric">${quarterData.average_score}ì </div><div class="metric-label">ì´ ${quarterData.total_count}ëª… í‰ê°€</div></div></div>
                    <div class="card"><div class="card-header"><h3>íŒ€ë³„ í‰ê·  ì ìˆ˜</h3><button class="toggle-btn" aria-label="ì¹´ë“œ ë³´ê¸°/ìˆ¨ê¸°ê¸°">${cardToggleIcon}</button></div><div class="card-content" style="margin-top: 5px;"><div class="list-item" style="background: var(--team1-bg);"><span>1íŒ€</span><span style="font-weight: bold; color: var(--team1-color);">${quarterData.team_avg['1íŒ€'] || 0}ì </span></div><div class="list-item" style="background: var(--team2-bg);"><span>2íŒ€</span><span style="font-weight: bold; color: var(--team2-color);">${quarterData.team_avg['2íŒ€'] || 0}ì </span></div></div></div>
                    <div class="card"><div class="card-header"><h3>ì „ì²´ TOP 3</h3><button class="toggle-btn" aria-label="ì¹´ë“œ ë³´ê¸°/ìˆ¨ê¸°ê¸°">${cardToggleIcon}</button></div><div class="card-content">${top3Html}</div></div>
                </div>
                <div class="card" style="margin-top: 20px;"><div class="card-header"><h3>ì ìˆ˜ ë¶„í¬</h3><button class="toggle-btn" aria-label="ì¹´ë“œ ë³´ê¸°/ìˆ¨ê¸°ê¸°">${cardToggleIcon}</button></div><div class="card-content"><div class="score-distribution">${scoreDistHtml}</div></div></div>
            `;
            
            new Sortable(document.querySelector('#quarterContent .dashboard'), { animation: 150, ghostClass: 'sortable-ghost' });
            const topScorersGridEl = document.querySelector('#quarterContent .top-scorers-grid');
            if (topScorersGridEl) new Sortable(topScorersGridEl, { animation: 150, ghostClass: 'sortable-ghost' });
        }

        function drawTrendChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');
            if (trendChart) trendChart.destroy();
            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.timeline.map(d => d.quarter),
                    datasets: [
                        { label: 'ì „ì²´ í‰ê· ', data: data.timeline.map(d => d.average), borderColor: 'var(--primary-color)', backgroundColor: 'rgba(52, 152, 219, 0.1)', borderWidth: 3, pointRadius: 6, pointBackgroundColor: 'var(--primary-color)', tension: 0.3, fill: true },
                        { label: '1íŒ€ í‰ê· ', data: data.timeline.map(d => d.team1_avg), borderColor: 'var(--team1-color)', backgroundColor: 'rgba(2, 132, 199, 0.1)', borderWidth: 2, pointRadius: 5, borderDash: [5, 5], tension: 0.3 },
                        { label: '2íŒ€ í‰ê· ', data: data.timeline.map(d => d.team2_avg), borderColor: 'var(--team2-color)', backgroundColor: 'rgba(190, 24, 93, 0.1)', borderWidth: 2, pointRadius: 5, borderDash: [5, 5], tension: 0.3 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { title: { display: false }, legend: { position: 'top', labels: { padding: 20, font: { size: 14 } } }, tooltip: { backgroundColor: 'rgba(0, 0, 0, 0.8)', padding: 12, cornerRadius: 8, titleFont: { size: 14 }, bodyFont: { size: 13 } } },
                    scales: { y: { min: 60, max: 100, ticks: { font: { size: 12 } }, grid: { color: 'rgba(0, 0, 0, 0.05)' } }, x: { ticks: { font: { size: 12 } }, grid: { display: false } } }
                }
            });
        }
        
        // --- AI Analysis Feature ---
        const aiModal = document.getElementById('ai-modal');
        const aiModalBody = document.getElementById('ai-modal-body');

        function showAiModal() {
            aiModal.classList.add('visible');
        }

        function closeAiModal() {
            aiModal.classList.remove('visible');
        }

        function simpleMarkdownToHtml(text) {
             return text
                .replace(/### (.*?)\n/g, '<h3>$1</h3>')
                .replace(/\*\* (.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\* (.*?)\n/g, '<li>$1</li>')
                .replace(/(\n<li>.*<\/li>)/g, '<ul>$1\n</ul>')
                .replace(/\n/g, '<br>');
        }

        async function generateAIAnalysis() {
            showAiModal();
            aiModalBody.innerHTML = '<div class="spinner"></div><p style="text-align: center;">AIê°€ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>';

            const timelineSummary = data.timeline.map(d => `${d.quarter}: ì „ì²´ í‰ê·  ${d.average}, 1íŒ€ ${d.team1_avg}, 2íŒ€ ${d.team2_avg}`).join('\n');
            let totalPerfect = 0;
            let total95 = 0;
            let total90 = 0;
            Object.values(data.quarters).forEach(q => {
                totalPerfect += q.perfect_scorers.length;
                total95 += q.top_non_perfect.filter(s => s.score === 95).length;
                total90 += q.top_non_perfect.filter(s => s.score === 90).length;
            });

            const prompt = `
                ë‹¹ì‹ ì€ ìœ ëŠ¥í•œ QA ë°ì´í„° ë¶„ì„ê°€ì…ë‹ˆë‹¤. ë‹¤ìŒ ë¶„ê¸°ë³„ QA í‰ê°€ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒì„¸í•œ ë¶„ì„ê³¼ ì‹¤í–‰ ê°€ëŠ¥í•œ ì œì–¸ì„ Markdown í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.

                **ì…ë ¥ ë°ì´í„°:**

                1.  **ë¶„ê¸°ë³„ ì ìˆ˜ ì¶”ì´:**
                    ${timelineSummary}

                2.  **ì£¼ìš” ê³ ë“ì ì í˜„í™© (ëˆ„ì ):**
                    - 100ì : ${totalPerfect}ëª…
                    - 95ì : ${total95}ëª…
                    - 90ì : ${total90}ëª…

                **ìš”ì²­ì‚¬í•­:**
                ì•„ë˜ êµ¬ì¡°ì— ë”°ë¼ í•œêµ­ì–´ë¡œ ë‹µë³€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”. ê° í•­ëª©ì€ ì¹œì ˆí•˜ê³  ì „ë¬¸ì ì¸ ë¶„ì„ê°€ì˜ í†¤ìœ¼ë¡œ ì„œìˆ í•´ì£¼ì„¸ìš”.

                ### ğŸ“ˆ ì¢…í•© í¼í¬ë¨¼ìŠ¤ ë¶„ì„
                ì „ì²´ í‰ê·  ì ìˆ˜ì˜ ë³€ë™ ì¶”ì„¸ì™€ ê·¸ ì˜ë¯¸ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”.

                ### ğŸ‘¥ íŒ€ë³„ ì„±ê³¼ ë¹„êµ
                1íŒ€ê³¼ 2íŒ€ì˜ í‰ê·  ì ìˆ˜ë¥¼ ë¹„êµí•˜ê³ , ê²©ì°¨ê°€ ë°œìƒí•˜ëŠ” ì›ì¸ì— ëŒ€í•´ ì¶”ì¸¡í•´ë³´ì„¸ìš”.

                ### ğŸ’¡ ì£¼ìš” ì¸ì‚¬ì´íŠ¸ ë° ë™í–¥
                ê³ ë“ì ì ë°ì´í„°ë‚˜ ì ìˆ˜ ë¶„í¬ì—ì„œ ë°œê²¬í•  ìˆ˜ ìˆëŠ” íŠ¹ë³„í•œ íŒ¨í„´ì´ë‚˜ ë™í–¥ì„ ì°¾ì•„ì£¼ì„¸ìš”.

                ### ğŸš€ ì‹¤í–‰ ê°€ëŠ¥í•œ ì œì–¸
                ë¶„ì„ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ìƒë‹´ í’ˆì§ˆì„ í–¥ìƒì‹œí‚¤ê³ , ì§ì›ë“¤ì˜ ë™ê¸° ë¶€ì—¬ë¥¼ ê°•í™”í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ë°©ì•ˆ 2-3ê°€ì§€ë¥¼ ì œì•ˆí•´ì£¼ì„¸ìš”.
            `;
            
            try {
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiKey = "AIzaSyAtRcgfYz-2DKtaRKWNqhz9kNIUQs26r_M"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ${response.statusText}`);
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const rawText = result.candidates[0].content.parts[0].text;
                    aiModalBody.innerHTML = simpleMarkdownToHtml(rawText);
                } else {
                    throw new Error("AIë¡œë¶€í„° ìœ íš¨í•œ ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                }
            } catch (error) {
                console.error("AI Analysis Error:", error);
                aiModalBody.innerHTML = `<p style="color: var(--danger-color); text-align: center;">AI ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>`;
            }
        }


        window.onload = function() {
            document.querySelectorAll('.tab:not(#tab-overall)').forEach(tab => {
                tab.id = `tab-${tab.textContent.replace(' ', '-')}`;
            });
            
            document.querySelector('.container').addEventListener('click', function(e) {
                const button = e.target.closest('.toggle-btn');
                if (!button) return;
                const card = button.closest('.card, .top-scorers-section');
                const content = card.querySelector('.card-content');
                button.classList.toggle('collapsed');
                content?.classList.toggle('hidden');
            });

            // AI Modal Listeners
            document.getElementById('ai-analysis-btn').addEventListener('click', generateAIAnalysis);
            document.getElementById('modal-close-btn').addEventListener('click', closeAiModal);
            aiModal.addEventListener('click', function(e) {
                if (e.target === aiModal) {
                    closeAiModal();
                }
            });

            showOverall();
            drawTrendChart();
        };
    </script>
</body>
</html>